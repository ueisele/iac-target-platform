---
- name: Common Tools
  hosts: all
  become: yes
  roles:
    - role: tools

- name: Resolvconf Setup
  hosts: all
  become: yes
  roles:
    - role: resolvconf
      config_resolvconf:
        - "domain {{ domainname }}"
        - "search {{ domainname }}"

#- name: Java Setup
#  hosts: all
#  become: yes
#  roles:
#    - role: geerlingguy.java
#      java_packages: 
#        - openjdk-8-jdk

#- name: Zookeeper Cluster Setup
#  hosts: zookeeper
#  become: yes
#  roles:
#    - role: AnsibleShipyard.ansible-zookeeper
#      zookeeper_version: "3.4.11"
#      zookeeper_hosts: "{{ groups['zookeeper'] }}"

- name: Consul Setup
  hosts: consul-server:consul-agent
  become: yes
  roles:
    - role: consul
      consul_version: "1.0.2"
      consul_checksum: "sha256:418329f0f4fc3f18ef08674537b576e57df3f3026f258794b4b4b611beae6c9b"
      consul_server_hosts: "{{ groups['consul-server'] }}"
      consul_domain: "consul"

- name: Traefik Setup
  hosts: public-lb
  become: yes
  roles:
    - role: traefik
      traefik_version: "1.5.0-rc4"
      traefik_checksum: "sha256:115e9dd4d76d1d63ba4fa65325e7e6df8f9bf85a77c1885e186060359fdf3c55"
      public_domain: "public.{{ domainname }}"

- name: Heartbeat Setup for Public LB
  hosts: public-lb
  become: yes
  roles:
    - role: heartbeat
      heartbeat_authkey: "heartbeat.{{ domainname }}"
      heartbeat_virtual_ip: "{{ publiclb_ip }}"
      heartbeat_member_hosts: "{{ groups['public-lb'] }}"

#- name: Mesos Master Cluster Setup
#  hosts: mesos-master
#  become: yes
#  roles:
#    - role: mesos-master
#      zookeeper_hosts: "{{ groups['zookeeper'] }}"   
#      config_mesos_master:
#        quorum: "{{ ((groups['zookeeper'] | length) / 2) | round | int }}"

#- name: Mesos Agent Cluster Setup
#  hosts: mesos-agent
#  become: yes
#  roles:
#    - role: mesos-agent
#      zookeeper_hosts: "{{ groups['zookeeper'] }}"   
#      config_mesos_agent: {}
